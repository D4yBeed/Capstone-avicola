<ion-header>
  <ion-toolbar color="light">
    <ion-title color="danger">Registro Diario</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/main/profile">
        <ion-icon name="person-circle-outline" color="danger"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="home-content">

  <form [formGroup]="form" (ngSubmit)="onSave()" class="home-form">

    <!-- Fecha -->
    <div class="date-box">
      <ion-icon name="calendar-outline" class="date-icon"></ion-icon>
      <span>{{ selectedDate }}</span>
    </div>

    <!-- Granja -->
    <ion-item lines="full" class="selector">
      <ion-label position="stacked">Granja</ion-label>
      <ion-select formControlName="farmId" interface="popover" color="danger">
        <ion-select-option *ngFor="let f of farms" [value]="f.id">{{ f.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Sector -->
    <ion-item lines="full" class="selector">
      <ion-label position="stacked">Sector</ion-label>
      <ion-select formControlName="sectorId" interface="popover" color="danger" [disabled]="user?.role === 'pollero'">
        <ion-select-option *ngFor="let s of sectors" [value]="s.id">{{ s.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Galpón -->
    <ion-item lines="full" class="selector">
      <ion-label position="stacked">Galpón</ion-label>
      <ion-select formControlName="shedId" interface="popover" color="danger" [disabled]="user?.role === 'pollero'">
        <ion-select-option *ngFor="let s of sheds" [value]="s.id">{{ s.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Conteo -->
    <ion-card class="count-card" *ngIf="ready">
      <ion-card-header>
        <ion-card-title color="danger" class="ion-text-center">Conteo por Calidad y Ubicación</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <div class="count-grid">
          <div class="count-row" *ngFor="let c of categories">
            <span class="label">{{ c.label }}</span>
            <div class="controls">
              <ion-button size="small" fill="solid" color="light" class="btn-minus" (click)="dec(c.key)">
                <ion-icon name="remove-outline"></ion-icon>
              </ion-button>

              <span class="count">{{ counts[c.key] || 0 }}</span>

              <ion-button size="small" fill="solid" color="danger" class="btn-plus" (click)="inc(c.key)">
                <ion-icon name="add-outline"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Notas -->
        <ion-item lines="none" class="notes">
          <ion-label position="stacked">Notas</ion-label>
          <ion-textarea formControlName="notes" placeholder="Observaciones del día..." autoGrow="true"></ion-textarea>
        </ion-item>

        <!-- Total -->
        <div class="total-box">
          <span>Total diario:</span>
          <strong>{{ totalDia }}</strong>
        </div>

        <!-- Botón Guardar -->
        <ion-button expand="block" type="submit" class="btn-save" color="danger">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          Guardar Registro
        </ion-button>
      </ion-card-content>
    </ion-card>
  </form>
</ion-content>
